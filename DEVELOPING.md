# Development guide

This Python package is 99% automatically generated by [OpenAPI Generator](https://openapi-generator.tech).
To regenerate the package with an updated API spec OR to increment the version number for any reason, run
the following command (make sure to replace `X.Y.Z` with the new version number!). Assumes that you have installed
openapi-generator via brew. The command invocation will vary for npm, Docker, and other installations, but the
arguments should remain the same.

```shell
openapi-generator generate -i https://api.stadiamaps.com/openapi.yaml -g python-nextgen --strict-spec=true -o . -p disallowAdditionalPropertiesIfNotPresent=false -p packageName=stadiamaps -p packageUrl=https://docs.stadiamaps.com/ -p packageVersion=X.Y.Z
```

## Tests

The OpenAPI generator adds some unit tests, but these appear to be more or less worthless?
We add our own integration tests in `test/integration`.

## Caveats

When running the generator, a number of files including the GitHub [python.yml](.github/workflows/python.yml)
action, [pyproject.toml](pyproject.toml), and [setup.py](setup.py). will be overwritten. This is generally the
right idea. However, the updated files will clobber several _intentional_ local modifications, so check your
git diff carefully before committing. You _will_ have to stage some chunks and remove others.
Sorry, not sorry; the automatic generator doesn't support enough configuration.

When making schema changes, you may need to temporarily remove [README.md](README.md) from
[.openapi-generator-ignore](.openapi-generator-ignore) and merge in the updated docs.

### Generator bugs

The following info is current as of v6.6.0.

The current release of the generator's `python` generator is completely broken, but `python-nextgen` works.
The next release is scheduled to rename `python-nextgen` to `python`.

The auto-generated code does not pass flake8, so we have disabled the checks.

The auto-generated model for time/distance matrix responses is broken. Specifically,
it does not correctly generate parsing code correctly for `sources`, `targets`, or
`sources_to_targets`. We have gone ahead and applied a quick-and-evil patch to
the auto-generated code. Be careful that you discard any changes when regenerating
models until the upstream fixes the issue ([link](https://github.com/OpenAPITools/openapi-generator/issues/15816)).
If you accidentally clobber these patches, the oversight should be caught by the
integration tests.
